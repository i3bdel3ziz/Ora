<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timesheet ‚Äî Monthly Hours (Qatar: Fri+Sat weekend)</title>
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = { darkMode: 'class' };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel" data-presets="react">
    const { useEffect, useMemo, useRef, useState } = React;

    function daysInMonth(year, monthIndex0) { return new Date(year, monthIndex0 + 1, 0).getDate(); }
    function fmt(n) { return (Math.round(n * 100) / 100).toFixed(2); }

    const STORAGE_KEY = 'hours-calculator-pages-v4';
    const WEEKDAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const WORKING_WEEK = ['Sun','Mon','Tue','Wed','Thu'];

    function useDarkMode() {
      const [dark, setDark] = useState(() => { try { return localStorage.getItem('hours-dark') === '1'; } catch { return false; } });
      useEffect(() => { try { localStorage.setItem('hours-dark', dark ? '1' : '0'); } catch {} document.documentElement.classList.toggle('dark', dark); }, [dark]);
      return { dark, setDark };
    }

    function App() {
      const today = new Date();
      const [year, setYear] = useState(today.getFullYear());
      const [month, setMonth] = useState(today.getMonth());
      const [hoursByDay, setHoursByDay] = useState({});
      const { dark, setDark } = useDarkMode();
      const inputRefs = useRef({});

      useEffect(() => { try { const raw = localStorage.getItem(STORAGE_KEY); if (raw) { const p = JSON.parse(raw); setYear(typeof p.year === 'number' ? p.year : year); setMonth(typeof p.month === 'number' ? p.month : month); setHoursByDay(p.hoursByDay ?? {}); } } catch {} }, []);
      useEffect(() => { try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ year, month, hoursByDay })); } catch {} }, [year, month, hoursByDay]);

      const totalDays = daysInMonth(year, month);
      const rows = useMemo(() => { const out=[]; let current=[null,null,null,null,null]; for (let d=1; d<=totalDays; d++){ const wd=new Date(year,month,d).getDay(); if (wd===5||wd===6) continue; const col=wd===0?0:wd; if (col===0 && current.some(c=>c!==null)){ out.push(current); current=[null,null,null,null,null]; } current[col]=d; if (col===4){ out.push(current); current=[null,null,null,null,null]; } } if (current.some(c=>c!==null)) out.push(current); return out; }, [year, month, totalDays]);

      const workingDays = useMemo(() => rows.flat().filter(Boolean).length, [rows]);
      const targetMonthlyHours = workingDays * 8;
      const actualMonthlyHours = useMemo(() => Object.values(hoursByDay).reduce((s,v)=>s+(Number(v)||0),0), [hoursByDay]);
      const diff = actualMonthlyHours - targetMonthlyHours;
      const monthLabel = useMemo(() => new Date(year, month, 1).toLocaleDateString(undefined, { month: 'long', year: 'numeric' }), [year, month]);

      const isToday = (d) => today.getFullYear()===year && today.getMonth()===month && today.getDate()===d;
      const getDayClass = (d) => { const v=hoursByDay[d]; if (typeof v!=='number') return ''; if (v>8) return 'bg-green-50 text-green-800 dark:bg-green-900/30 dark:text-green-200'; if (v<8) return 'bg-amber-50 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200'; return ''; };

      return (
        <div className="min-h-screen w-full">
          <div className="max-w-5xl mx-auto p-6">
            <header className="mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <h1 className="text-2xl font-bold">Timesheet ‚Äî {monthLabel} {diff >= 0 ? 'üéâ' : '‚ö†Ô∏è'}</h1>
              <div className="flex flex-wrap gap-2 items-center">
                <label className="text-sm flex items-center gap-2">
                  <span>Month</span>
                  <select className="rounded-lg border px-3 py-2 bg-white dark:bg-gray-800" value={month} onChange={e=>setMonth(Number(e.target.value))}>
                    {Array.from({length:12}).map((_,i)=>(<option key={i} value={i}>{new Date(2020,i,1).toLocaleString(undefined,{month:'long'})}</option>))}
                  </select>
                </label>
                <label className="text-sm flex items-center gap-2">
                  <span>Year</span>
                  <input type="number" className="rounded-lg border px-3 py-2 w-28 bg-white dark:bg-gray-800" value={year} onChange={e=>setYear(Number(e.target.value))} />
                </label>
                <button onClick={()=>{ const now=new Date(); setYear(now.getFullYear()); setMonth(now.getMonth()); }} className="px-3 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600">Reset</button>
                <button onClick={()=>{ const next={...hoursByDay}; rows.flat().filter(Boolean).forEach(d=>{ next[d]=8; }); setHoursByDay(next); }} className="px-3 py-2 rounded-xl bg-gray-900 text-white shadow hover:opacity-90">Fill all</button>
                <button onClick={()=>setHoursByDay({})} className="px-3 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600">Clear all</button>
                <button onClick={()=>setDark(!dark)} className="px-3 py-2 rounded-xl bg-gray-800 text-white dark:bg-gray-200 dark:text-gray-900">{dark ? '‚òÄÔ∏è Light' : 'üåô Dark'}</button>
              </div>
            </header>

            <div className="grid sm:grid-cols-3 gap-3 mb-4">
              <div className="bg-white dark:bg-gray-800 rounded-xl p-3">
                <div className="text-gray-600 dark:text-gray-300 text-sm">Target hours</div>
                <div className="text-xl font-bold">{fmt(targetMonthlyHours)}</div>
              </div>
              <div className="bg-white dark:bg-gray-800 rounded-xl p-3">
                <div className="text-gray-600 dark:text-gray-300 text-sm">Actual hours</div>
                <div className="text-xl font-bold">{fmt(actualMonthlyHours)}</div>
              </div>
              <div className={`rounded-xl p-3 ${diff>=0 ? 'bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-200' : 'bg-amber-50 text-amber-700 dark:bg-amber-900/30 dark:text-amber-200'}`}>
                <div className="text-sm font-semibold">{diff>=0? 'Exceed by':'Shortage of'}</div>
                <div className="text-xl font-bold">{fmt(Math.abs(diff))} h</div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
